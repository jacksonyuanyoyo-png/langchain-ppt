<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangGraph å·¥ä½œæµç¨‹å›¾</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        
        .workflow-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin: 40px 0;
        }
        
        .node {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border: 3px solid #3498db;
            border-radius: 15px;
            padding: 25px;
            min-width: 300px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .node:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
            border-color: #2980b9;
        }
        
        .node.start {
            background: linear-gradient(145deg, #e8f5e8, #c8e6c9);
            border-color: #27ae60;
        }
        
        .node.end {
            background: linear-gradient(145deg, #fce4ec, #f8bbd9);
            border-color: #e91e63;
        }
        
        .node.process {
            background: linear-gradient(145deg, #e3f2fd, #bbdefb);
            border-color: #2196f3;
        }
        
        .node-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .node-description {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .node-details {
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .arrow {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid #3498db;
            margin: 10px auto;
            position: relative;
        }
        
        .arrow::after {
            content: '';
            position: absolute;
            top: -35px;
            left: -15px;
            width: 30px;
            height: 4px;
            background: #3498db;
        }
        
        .state-info {
            background: #f8f9fa;
            border-left: 5px solid #3498db;
            padding: 20px;
            margin: 30px 0;
            border-radius: 0 10px 10px 0;
        }
        
        .state-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .state-field {
            margin: 8px 0;
            padding: 8px 12px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #3498db;
        }
        
        .field-name {
            font-weight: bold;
            color: #2980b9;
        }
        
        .field-type {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .data-flow {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .flow-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }
        
        .flow-content {
            color: #856404;
            font-size: 0.95em;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        
        .legend-start { background: linear-gradient(145deg, #e8f5e8, #c8e6c9); }
        .legend-process { background: linear-gradient(145deg, #e3f2fd, #bbdefb); }
        .legend-end { background: linear-gradient(145deg, #fce4ec, #f8bbd9); }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .node {
                min-width: 250px;
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .legend {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ LangGraph å·¥ä½œæµç¨‹å›¾</h1>
        <p class="subtitle">èŠå¤©æœºå™¨äººçš„å®Œæ•´å¤„ç†æµç¨‹</p>
        
        <!-- çŠ¶æ€å®šä¹‰ -->
        <div class="state-info">
            <div class="state-title">ğŸ“Š GraphState çŠ¶æ€å®šä¹‰</div>
            <div class="state-field">
                <span class="field-name">messages:</span> 
                <span class="field-type">List[BaseMessage]</span> - å¯¹è¯æ¶ˆæ¯åˆ—è¡¨
            </div>
            <div class="state-field">
                <span class="field-name">user_intent:</span> 
                <span class="field-type">str</span> - ç”¨æˆ·æ„å›¾åˆ†ç±»
            </div>
            <div class="state-field">
                <span class="field-name">current_step:</span> 
                <span class="field-type">str</span> - å½“å‰å¤„ç†æ­¥éª¤
            </div>
            <div class="state-field">
                <span class="field-name">conversation_history:</span> 
                <span class="field-type">List[str]</span> - å¯¹è¯å†å²è®°å½•
            </div>
        </div>
        
        <!-- å·¥ä½œæµç¨‹ -->
        <div class="workflow-container">
            <!-- å¼€å§‹èŠ‚ç‚¹ -->
            <div class="node start">
                <div class="node-title">ğŸš€ START</div>
                <div class="node-description">ç”¨æˆ·è¾“å…¥æ¶ˆæ¯ï¼Œå·¥ä½œæµå¼€å§‹æ‰§è¡Œ</div>
                <div class="node-details">
                    <strong>è¾“å…¥ï¼š</strong>ç”¨æˆ·æ¶ˆæ¯ (HumanMessage)<br>
                    <strong>è§¦å‘ï¼š</strong>chat() æˆ– chat_sync() æ–¹æ³•è°ƒç”¨
                </div>
            </div>
            
            <div class="arrow"></div>
            
            <!-- æ•°æ®æµè¯´æ˜ -->
            <div class="data-flow">
                <div class="flow-title">ğŸ“¥ æ•°æ®æµå…¥</div>
                <div class="flow-content">
                    ç”¨æˆ·æ¶ˆæ¯è¢«æ·»åŠ åˆ° state.messages åˆ—è¡¨ä¸­<br>
                    è®¾ç½®å…¥å£ç‚¹ä¸º "analyze_intent"
                </div>
            </div>
            
            <!-- æ„å›¾åˆ†æèŠ‚ç‚¹ -->
            <div class="node process">
                <div class="node-title">ğŸ§  analyze_intent</div>
                <div class="node-description">åˆ†æç”¨æˆ·è¾“å…¥çš„æ„å›¾ç±»å‹</div>
                <div class="node-details">
                    <strong>åŠŸèƒ½ï¼š</strong><br>
                    â€¢ æ£€æµ‹é—®å€™è¯­ ("ä½ å¥½", "hello")<br>
                    â€¢ è¯†åˆ«å‘Šåˆ«è¯­ ("å†è§", "bye")<br>
                    â€¢ åˆ¤æ–­æ˜¯å¦ä¸ºé—®é¢˜ (åŒ…å« "?")<br>
                    â€¢ é»˜è®¤åˆ†ç±»ä¸º "general_question"<br><br>
                    <strong>è¾“å‡ºï¼š</strong>user_intent, current_step
                </div>
            </div>
            
            <div class="arrow"></div>
            
            <div class="data-flow">
                <div class="flow-title">ğŸ”„ çŠ¶æ€æ›´æ–°</div>
                <div class="flow-content">
                    state.user_intent = åˆ†æç»“æœ<br>
                    state.current_step = "intent_analyzed"
                </div>
            </div>
            
            <!-- å›å¤ç”ŸæˆèŠ‚ç‚¹ -->
            <div class="node process">
                <div class="node-title">ğŸ’¬ generate_response</div>
                <div class="node-description">ä½¿ç”¨ LLM ç”Ÿæˆæ™ºèƒ½å›å¤</div>
                <div class="node-details">
                    <strong>åŠŸèƒ½ï¼š</strong><br>
                    â€¢ ä½¿ç”¨ ChatOpenAI (GPT-3.5-turbo)<br>
                    â€¢ åº”ç”¨ç³»ç»Ÿæç¤ºæ¨¡æ¿<br>
                    â€¢ å¤„ç†ç”¨æˆ·è¾“å…¥å¹¶ç”Ÿæˆå›å¤<br>
                    â€¢ å°† AI å›å¤æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨<br><br>
                    <strong>è¾“å‡ºï¼š</strong>æ›´æ–°çš„ messages åˆ—è¡¨
                </div>
            </div>
            
            <div class="arrow"></div>
            
            <div class="data-flow">
                <div class="flow-title">ğŸ”„ çŠ¶æ€æ›´æ–°</div>
                <div class="flow-content">
                    state.messages.append(AIMessage)<br>
                    state.current_step = "response_generated"
                </div>
            </div>
            
            <!-- å¯¹è¯ä¿å­˜èŠ‚ç‚¹ -->
            <div class="node process">
                <div class="node-title">ğŸ’¾ save_conversation</div>
                <div class="node-description">ä¿å­˜å¯¹è¯å†å²åˆ°å†…å­˜</div>
                <div class="node-details">
                    <strong>åŠŸèƒ½ï¼š</strong><br>
                    â€¢ æå–æœ€è¿‘çš„ç”¨æˆ·å’ŒAIæ¶ˆæ¯<br>
                    â€¢ æ ¼å¼åŒ–å¯¹è¯æ¡ç›®<br>
                    â€¢ æ·»åŠ åˆ°å¯¹è¯å†å²åˆ—è¡¨<br>
                    â€¢ æ”¯æŒå¤šçº¿ç¨‹å¯¹è¯ç®¡ç†<br><br>
                    <strong>è¾“å‡ºï¼š</strong>æ›´æ–°çš„ conversation_history
                </div>
            </div>
            
            <div class="arrow"></div>
            
            <div class="data-flow">
                <div class="flow-title">ğŸ”„ çŠ¶æ€æ›´æ–°</div>
                <div class="flow-content">
                    state.conversation_history.append(æ ¼å¼åŒ–å¯¹è¯)<br>
                    state.current_step = "conversation_saved"
                </div>
            </div>
            
            <!-- ç»“æŸèŠ‚ç‚¹ -->
            <div class="node end">
                <div class="node-title">ğŸ END</div>
                <div class="node-description">å·¥ä½œæµç»“æŸï¼Œè¿”å›æœ€ç»ˆç»“æœ</div>
                <div class="node-details">
                    <strong>è¾“å‡ºï¼š</strong>å®Œæ•´çš„çŠ¶æ€å¯¹è±¡<br>
                    <strong>è¿”å›ï¼š</strong>AI ç”Ÿæˆçš„å›å¤å†…å®¹<br>
                    <strong>æŒä¹…åŒ–ï¼š</strong>é€šè¿‡ MemorySaver ä¿å­˜çŠ¶æ€
                </div>
            </div>
        </div>
        
        <!-- ç‰¹æ®ŠåŠŸèƒ½è¯´æ˜ -->
        <div class="state-info">
            <div class="state-title">ğŸ”§ æ ¸å¿ƒç‰¹æ€§</div>
            <div class="state-field">
                <span class="field-name">æ£€æŸ¥ç‚¹ä¿å­˜:</span> 
                ä½¿ç”¨ MemorySaver åœ¨æ¯ä¸ªæ­¥éª¤ä¿å­˜çŠ¶æ€
            </div>
            <div class="state-field">
                <span class="field-name">å¤šçº¿ç¨‹æ”¯æŒ:</span> 
                é€šè¿‡ thread_id æ”¯æŒå¹¶å‘å¯¹è¯
            </div>
            <div class="state-field">
                <span class="field-name">çŠ¶æ€æŒä¹…åŒ–:</span> 
                å¯¹è¯å†å²å’ŒçŠ¶æ€åœ¨ä¼šè¯é—´ä¿æŒ
            </div>
            <div class="state-field">
                <span class="field-name">é”™è¯¯å¤„ç†:</span> 
                æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
            </div>
        </div>
        
        <!-- å›¾ä¾‹ -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color legend-start"></div>
                <span>å¼€å§‹/ç»“æŸèŠ‚ç‚¹</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-process"></div>
                <span>å¤„ç†èŠ‚ç‚¹</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-end"></div>
                <span>ç»ˆæ­¢èŠ‚ç‚¹</span>
            </div>
        </div>
        
        <!-- æ‰§è¡Œæµç¨‹è¯´æ˜ -->
        <div class="state-info">
            <div class="state-title">âš¡ æ‰§è¡Œæµç¨‹æ€»ç»“</div>
            <p><strong>1. åˆå§‹åŒ–ï¼š</strong> ç”¨æˆ·è°ƒç”¨ chat() æ–¹æ³•ï¼Œä¼ å…¥æ¶ˆæ¯</p>
            <p><strong>2. çŠ¶æ€å‡†å¤‡ï¼š</strong> å°†ç”¨æˆ·æ¶ˆæ¯æ·»åŠ åˆ°çŠ¶æ€çš„ messages åˆ—è¡¨</p>
            <p><strong>3. å›¾æ‰§è¡Œï¼š</strong> æŒ‰ç…§å®šä¹‰çš„è¾¹ä¾æ¬¡æ‰§è¡Œå„ä¸ªèŠ‚ç‚¹</p>
            <p><strong>4. çŠ¶æ€ä¼ é€’ï¼š</strong> æ¯ä¸ªèŠ‚ç‚¹æ›´æ–°çŠ¶æ€å¹¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p>
            <p><strong>5. æ£€æŸ¥ç‚¹ä¿å­˜ï¼š</strong> åœ¨æ¯ä¸ªæ­¥éª¤è‡ªåŠ¨ä¿å­˜çŠ¶æ€åˆ°å†…å­˜</p>
            <p><strong>6. ç»“æœè¿”å›ï¼š</strong> æå–AIå›å¤å¹¶è¿”å›ç»™ç”¨æˆ·</p>
        </div>
    </div>
</body>
</html>
